<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Змейка с анимацией</title>
<style>
  body {
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: #222;
    overflow: hidden;
    position: relative;
    font-family: Arial, sans-serif;
  }
  canvas {
    background: #111;
    border-radius: 20px;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
  }
  #restart {
    position: absolute;
    padding: 15px 30px;
    font-size: 24px;
    border: none;
    border-radius: 12px;
    background: #E91E63;
    color: white;
    cursor: pointer;
    display: none;
    z-index: 10;
  }
  #controls {
    position: absolute;
    bottom: 20px;
    display: grid;
    grid-template-columns: 60px 60px 60px;
    grid-template-rows: 60px 60px 60px;
    gap: 10px;
    justify-items: center;
    align-items: center;
    user-select: none;
  }
  .btn {
    width: 60px;
    height: 60px;
    font-size: 28px;
    border-radius: 50%;
    border: none;
    background: #E91E63;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    touch-action: manipulation;
  }
</style>
</head>
<body>
<canvas id="game"></canvas>
<button id="restart">Заново</button>

<div id="controls">
  <div></div><button class="btn" id="up">↑</button><div></div>
  <button class="btn" id="left">←</button><div></div><button class="btn" id="right">→</button>
  <div></div><button class="btn" id="down">↓</button><div></div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// вертикальное поле 14x24
const cols = 14;
const rows = 24;
let tileSize;

function resizeCanvas() {
  tileSize = Math.min(
    (window.innerWidth - 40) / cols,
    (window.innerHeight - 100) / rows
  );
  canvas.width = cols * tileSize;
  canvas.height = rows * tileSize;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

let snake, dx, dy, food, foodImage, gameOver, score;
let pulse = 0;
let particles = [];

const foodImages = [];
for(let i=1;i<=8;i++){
  const img = new Image();
  img.src = `balzam${i}.png`;
  foodImages.push(img);
}

function initGame(){
  snake = [
    {x:5,y:5},{x:4,y:5},{x:3,y:5}
  ];
  dx=1; dy=0;
  score=0;
  gameOver=false;
  particles=[];
  placeFood();
  document.getElementById("restart").style.display="none";
  loop();
}

function placeFood(){
  food={x:Math.floor(Math.random()*cols), y:Math.floor(Math.random()*rows)};
  foodImage=foodImages[Math.floor(Math.random()*foodImages.length)];
}

function createParticles(x,y,color){
  for(let i=0;i<15;i++){
    particles.push({
      x:x, y:y,
      vx:(Math.random()-0.5)*8,
      vy:(Math.random()-0.5)*8,
      life:12,
      color:color
    });
  }
}

function updateParticles(){
  particles.forEach(p=>{p.x+=p.vx; p.y+=p.vy; p.life--;});
  particles = particles.filter(p=>p.life>0);
}

function drawParticles(){
  particles.forEach(p=>{
    ctx.fillStyle=p.color;
    ctx.globalAlpha=p.life/12;
    ctx.beginPath();
    ctx.arc(p.x,p.y,3,0,Math.PI*2);
    ctx.fill();
    ctx.globalAlpha=1;
  });
}

function drawSnake(){
  snake.forEach((seg,index)=>{
    const ratio=index/snake.length;
    const baseColor={r:225,g:89,b:169};
    const r=baseColor.r;
    const g=Math.floor(baseColor.g-ratio*50);
    const b=Math.floor(baseColor.b-ratio*50);
    ctx.fillStyle=`rgb(${r},${g},${b})`;

    ctx.beginPath();
    ctx.arc(seg.x*tileSize+tileSize/2, seg.y*tileSize+tileSize/2, tileSize/2,0,Math.PI*2);
    ctx.fill();
  });

  const head=snake[0];
  const eyeRadius=tileSize/6;
  const eyeOffsetX=tileSize/4;
  const eyeOffsetY=tileSize/6;

  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.arc(head.x*tileSize+tileSize/2-eyeOffsetX, head.y*tileSize+tileSize/2-eyeOffsetY, eyeRadius,0,Math.PI*2);
  ctx.arc(head.x*tileSize+tileSize/2+eyeOffsetX, head.y*tileSize+tileSize/2-eyeOffsetY, eyeRadius,0,Math.PI*2);
  ctx.fill();

  ctx.fillStyle="black";
  ctx.beginPath();
  ctx.arc(head.x*tileSize+tileSize/2-eyeOffsetX, head.y*tileSize+tileSize/2-eyeOffsetY, eyeRadius/2,0,Math.PI*2);
  ctx.arc(head.x*tileSize+tileSize/2+eyeOffsetX, head.y*tileSize+tileSize/2-eyeOffsetY, eyeRadius/2,0,Math.PI*2);
  ctx.fill();
}

function drawFood(){
  if(foodImage && foodImage.complete){
    pulse+=0.05;
    const scale = 1 + Math.sin(pulse)*0.125;
    const maxTileSize = tileSize*2;

    let drawWidth, drawHeight;
    if(foodImage.width>foodImage.height){
      drawWidth=maxTileSize*scale;
      drawHeight=foodImage.height*(drawWidth/foodImage.width);
    } else {
      drawHeight=maxTileSize*scale;
      drawWidth=foodImage.width*(drawHeight/foodImage.height);
    }

    const offsetX=food.x*tileSize + (tileSize - drawWidth)/2;
    const offsetY=food.y*tileSize + (tileSize - drawHeight)/2;

    ctx.drawImage(foodImage, offsetX, offsetY, drawWidth, drawHeight);
  }
}

function update(){
  if(gameOver) return;
  const head={x:snake[0].x+dx, y:snake[0].y+dy};
  if(head.x<0||head.y<0||head.x>=cols||head.y>=rows||snake.some(s=>s.x===head.x&&s.y===head.y)){
    gameOver=true;
    const restartBtn=document.getElementById("restart");
    restartBtn.style.display="block";
    restartBtn.style.left=(window.innerWidth/2 - restartBtn.offsetWidth/2)+"px";
    restartBtn.style.top=(window.innerHeight/2 - restartBtn.offsetHeight/2)+"px";
    createParticles(head.x*tileSize+tileSize/2, head.y*tileSize+tileSize/2,"#E159A9");
    return;
  }
  snake.unshift(head);
  if(head.x===food.x && head.y===food.y){
    score+=100;
    createParticles(food.x*tileSize+tileSize/2, food.y*tileSize+tileSize/2,"yellow");
    placeFood();
  } else snake.pop();
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawSnake();
  drawFood();
  drawParticles();
  ctx.fillStyle="white";
  ctx.font="20px Arial";
  ctx.fillText("Счёт: "+score,10,25);
}

function loop(){
  update();
  draw();
  updateParticles();
  if(!gameOver) setTimeout(loop,120);
}

document.addEventListener("keydown",e=>{
  if(e.key==="ArrowUp" && dy===0){dx=0; dy=-1;}
  else if(e.key==="ArrowDown" && dy===0){dx=0; dy=1;}
  else if(e.key==="ArrowLeft" && dx===0){dx=-1; dy=0;}
  else if(e.key==="ArrowRight" && dx===0){dx=1; dy=0;}
});

// кнопки крестовины
document.getElementById("up").addEventListener("click",()=>{if(dy===0){dx=0;dy=-1;}});
document.getElementById("down").addEventListener("click",()=>{if(dy===0){dx=0;dy=1;}});
document.getElementById("left").addEventListener("click",()=>{if(dx===0){dx=-1;dy=0;}});
document.getElementById("right").addEventListener("click",()=>{if(dx===0){dx=1;dy=0;}});

document.getElementById("restart").addEventListener("click", initGame);
initGame();
</script>
</body>
</html>








